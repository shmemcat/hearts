# Dev: web runs Next.js dev server in Docker with hot reload (source mounted).
# Uses port 3001 so something else can keep using 3000 without conflict.
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
# First time or after deps change: add --build (e.g. up:build)

services:
  api:
    environment:
      CORS_ORIGINS: http://localhost:3001
      FRONTEND_URL: http://localhost:3001

  web:
    image: hearts-web-dev
    build:
      context: ./web
      dockerfile: Dockerfile.dev
      args:
        - FONTAWESOME_PACKAGE_TOKEN=${FONTAWESOME_PACKAGE_TOKEN:-}
    ports:
      - '3001:3000'
    volumes:
      - ./web:/app
      - web_node_modules:/app/node_modules
    environment:
      - NODE_ENV=development
      - WATCHPACK_POLLING=true
    command: sh -c "npm install && npm run dev -- -H 0.0.0.0"
    restart: 'no'

volumes:
  web_node_modules:
    name: hearts_web_node_modules
